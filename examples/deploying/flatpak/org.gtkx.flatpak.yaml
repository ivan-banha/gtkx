app-id: org.gtkx.flatpak
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
# Add Node.js 22 extension to the SDK
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node22
command: gtkx-flatpak-demo
# Sandbox permissions
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
build-options:
  # Add Node.js binary to the path
  append-path: /usr/lib/sdk/node22/bin
  env:
    npm_config_nodedir: /usr/lib/sdk/node22
  no-debuginfo: true
  strip: false
modules:
  - name: gtkx-flatpak
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    # Install the pre-built binary and native module
    build-commands:
      - install -Dm755 dist/app /app/bin/app
      - install -Dm755 dist/index.node /app/bin/index.node
      - install -Dm644 assets/app.desktop /app/share/applications/app.desktop
      - install -Dm644 assets/icon.png /app/share/icons/hicolor/256x256/apps/icon.png
    sources:
      - type: dir
        path: ..
        skip:
          - .flatpak-builder
          - build-dir
          - node_modules
          - node-v22.12.0-linux-x64
          - node-v22.12.0-linux-x64.tar.xz
          - generated-sources.json
          - additional-sources.json
